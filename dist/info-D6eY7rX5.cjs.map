{"version":3,"file":"info-D6eY7rX5.cjs","names":["URL","url"],"sources":["../src/util.ts","../src/info.ts"],"sourcesContent":["/** @internal @packageDocumentation */\nimport { URL } from 'url'\nimport { isAxiosError, type AxiosError } from 'axios'\n/* eslint-disable camelcase */\nexport interface PaginatedQuery<T> {\n  collection: T[],\n  total_results?: number, // is omitted if limit parameter is supplied\n  next_href: string,\n  query_urn: string\n}\nexport const resolveURL = 'https://api-v2.soundcloud.com/resolve'\nexport const handleRequestErrs = (err: unknown): Error => {\n  // Obsługa błędów nie-Axios\n  if (!isAxiosError(err)) {\n    if (err instanceof Error) {\n      return err;\n    }\n    return new Error('Unknown error occurred', { cause: err });\n  }\n  const axiosErr = err as AxiosError;\n\n  // Brak odpowiedzi - problemy sieciowe\n  if (!axiosErr.response) {\n    // Obsługa obu kodów timeout: ECONNABORTED i ETIMEDOUT\n    const code = axiosErr.code;\n    const message = code === 'ECONNABORTED' || code === 'ETIMEDOUT'\n      ? 'Request timeout. Please check your connection.'\n      : code === 'ERR_NETWORK'\n        ? 'Network error. Please check your internet connection.'\n        : code === 'ERR_CANCELED'\n          ? 'Request was canceled.'\n          : 'Request failed. Please try again.';\n    return new Error(message, { cause: axiosErr });\n  }\n  const status = axiosErr.response.status;\n  let descriptiveMessage: string;\n  switch (status) {\n    case 400:\n      descriptiveMessage = 'Bad request. Please check the parameters.';\n      break;\n    case 401:\n      descriptiveMessage = 'Authentication failed. Is your Client ID correct?';\n      break;\n    case 403:\n      descriptiveMessage = 'Access forbidden. You may not have permission to access this resource.';\n      break;\n    case 404:\n      descriptiveMessage = 'Resource not found. It may be private or the URL is incorrect.';\n      break;\n    case 429:\n      descriptiveMessage = 'Rate limit exceeded. Please wait before making more requests.';\n      break;\n    case 500:\n    case 502:\n    case 503:\n    case 504:\n      descriptiveMessage = 'SoundCloud server error. Please try again later.';\n      break;\n    default:\n      descriptiveMessage = `Request failed with status ${status}: ${axiosErr.message}`;\n  }\n  return new Error(descriptiveMessage, { cause: axiosErr });\n}\nexport const appendURL = (url: string, ...params: string[]): string => {\n  try {\n    const u = new URL(url);\n\n    // Walidacja: params musi być parzystej długości\n    if (params.length % 2 !== 0) {\n      throw new Error(\n        `Parameters must be provided in key-value pairs. Received ${params.length} parameters.`\n      );\n    }\n    for (let idx = 0; idx < params.length; idx += 2) {\n      const key = params[idx];\n      const value = params[idx + 1];\n\n      if (key && value !== undefined && value !== null) {\n        u.searchParams.append(key, value);\n      }\n    }\n\n    return u.href;\n  } catch (err) {\n    if (err instanceof TypeError) {\n      throw new Error(`Invalid URL: ${url}`, { cause: err });\n    }\n    throw err;\n  }\n}\nexport const extractIDFromPersonalizedTrackURL = (url: string): string => {\n  if (!url || typeof url !== 'string') return '';\n  if (!url.includes('https://soundcloud.com/discover/sets/personalized-tracks::')) return '';\n\n  const colonIndex = url.lastIndexOf(':');\n  if (colonIndex === -1) return '';\n\n  return url.slice(colonIndex + 1);\n}\nexport const kindMismatchError = (expected: string, received: string): Error =>\n  new Error(`Expected resource of kind: (${expected}), received: (${received})`);\n","/* eslint-disable camelcase */\nimport type { AxiosInstance } from 'axios'\nimport { handleRequestErrs, appendURL, extractIDFromPersonalizedTrackURL } from './util'\nimport STREAMING_PROTOCOLS from './protocols'\nimport FORMATS from './formats'\n\n/**\n * A Soundcloud user\n */\nexport interface User {\n  kind: string,\n  avatar_url: string,\n  city: string,\n  comments_count: number,\n  country_code: string,\n  created_at: string,\n  description: string,\n  followers_count: number,\n  followings_count: number,\n  first_name: string,\n  full_name: string,\n  groups_count: number,\n  id: number,\n  last_name: string,\n  permalink_url: string,\n  uri: string,\n  username: string\n}\n\n/**\n * Details about the track\n */\nexport interface TrackInfo {\n  kind: string\n  monetization_model: string,\n  id: number,\n  policy: string,\n  comment_count?: number,\n  full_duration?: number,\n  downloadable?: false,\n  created_at?: string,\n  description?: string,\n  media?: { transcodings: Transcoding[] },\n  title?: string,\n  publisher_metadata?: any,\n  duration?: number,\n  has_downloads_left?: boolean,\n  artwork_url?: string,\n  public?: boolean,\n  streamable?: true,\n  tag_list?: string,\n  genre?: string,\n  reposts_count?: number,\n  label_name?: string,\n  state?: string,\n  last_modified?: string,\n  commentable?: boolean,\n  uri?: string,\n  download_count?: number,\n  likes_count?: number,\n  display_date?: string,\n  user_id?: number,\n  waveform_url?: string,\n  permalink?: string,\n  permalink_url?: string,\n  user?: User,\n  playback_count?: number\n}\n\n/**\n * Details about a Set\n */\nexport interface SetInfo {\n  duration: number,\n  permalink_url: string,\n  reposts_count: number,\n  genre: string,\n  permalink: string,\n  purchase_url?: string,\n  description?: string,\n  uri: string,\n  label_name?: string,\n  tag_list: string,\n  set_type: string,\n  public: boolean,\n  track_count: number,\n  user_id: number,\n  last_modified: string,\n  license: string,\n  tracks: TrackInfo[],\n  id: number,\n  release_date?: string,\n  display_date: string,\n  sharing: string,\n  secret_token?: string,\n  created_at: string,\n  likes_count: number,\n  kind: string,\n  purchase_title?: string,\n  managed_by_feeds: boolean,\n  artwork_url?: string,\n  is_album: boolean,\n  user: User,\n  published_at: string,\n  embeddable_by: string\n}\n\n/**\n * Represents an audio link to a Soundcloud Track\n */\nexport interface Transcoding {\n  url: string,\n  preset: string,\n  snipped: boolean,\n  format: { protocol: STREAMING_PROTOCOLS, mime_type: FORMATS }\n}\n\nconst getTrackInfoBase = async (clientID: string, axiosRef: AxiosInstance, ids: number[], playlistID?: number, playlistSecretToken?: string): Promise<TrackInfo[]> => {\n  let url = appendURL('https://api-v2.soundcloud.com/tracks', 'ids', ids.join(','), 'client_id', clientID)\n  if (playlistID && playlistSecretToken) {\n    url = appendURL(url, 'playlistId', String(playlistID), 'playlistSecretToken', playlistSecretToken)\n  }\n  try {\n    const { data } = await axiosRef.get(url)\n\n    return data as TrackInfo[]\n  } catch (err) {\n    throw handleRequestErrs(err)\n  }\n}\n\n/** @internal */\nexport const getInfoBase = async <T extends TrackInfo | SetInfo>(url: string, clientID: string, axiosRef: AxiosInstance): Promise<T> => {\n  try {\n    const res = await axiosRef.get(appendURL('https://api-v2.soundcloud.com/resolve', 'url', url, 'client_id', clientID), {\n      withCredentials: true\n    })\n\n    return res.data as T\n  } catch (err) {\n    throw handleRequestErrs(err)\n  }\n}\n\n/** @internal */\nconst getSetInfoBase = async (url: string, clientID: string, axiosRef: AxiosInstance): Promise<SetInfo> => {\n  const setInfo = await getInfoBase<SetInfo>(url, clientID, axiosRef)\n  const originalOrder = setInfo.tracks.map(track => track.id)\n  const playlistID = setInfo.id\n  const playlistSecretToken = setInfo.secret_token\n  const incompleteTracks = setInfo.tracks.filter(track => !track.title)\n\n  if (incompleteTracks.length === 0) {\n    return setInfo\n  }\n\n  const completeTracks = setInfo.tracks.filter(track => track.title)\n  const incompleteIds = incompleteTracks.map(t => t.id)\n\n  if (incompleteIds.length > 50) {\n    const batchSize = 50\n    const batches: number[][] = []\n\n    for (let i = 0; i < incompleteIds.length; i += batchSize) {\n      batches.push(incompleteIds.slice(i, i + batchSize))\n    }\n\n    const promises = batches.map(ids => getTrackInfoByID(clientID, axiosRef, ids, playlistID, playlistSecretToken))\n    const fetchedTracks = await Promise.all(promises)\n    setInfo.tracks = completeTracks.concat(...fetchedTracks)\n  } else {\n    const fetchedTracks = await getTrackInfoByID(clientID, axiosRef, incompleteIds, playlistID, playlistSecretToken)\n    setInfo.tracks = completeTracks.concat(fetchedTracks)\n  }\n\n  setInfo.tracks = sortTracks(setInfo.tracks, originalOrder)\n  return setInfo\n}\n\n/** @internal */\nconst sortTracks = (tracks: TrackInfo[], ids: number[]): TrackInfo[] => {\n  const trackMap = new Map<number, TrackInfo>()\n\n  for (const track of tracks) {\n    trackMap.set(track.id, track)\n  }\n\n  const sorted: TrackInfo[] = []\n  for (const id of ids) {\n    const track = trackMap.get(id)\n    if (track) {\n      sorted.push(track)\n    }\n  }\n\n  return sorted\n}\n\n/** @internal */\nconst getInfo = async (url: string, clientID: string, axiosInstance: AxiosInstance): Promise<TrackInfo> => {\n  let data: TrackInfo\n\n  if (url.includes('https://soundcloud.com/discover/sets/personalized-tracks::')) {\n    const idString = extractIDFromPersonalizedTrackURL(url)\n    if (!idString) throw new Error('Could not parse track ID from given URL: ' + url)\n\n    const id = parseInt(idString, 10)\n    if (isNaN(id)) {\n      throw new Error('Could not parse track ID from given URL: ' + url)\n    }\n\n    const tracks = await getTrackInfoByID(clientID, axiosInstance, [id])\n    const track = tracks[0]\n    if (!track) throw new Error('Could not find track with ID: ' + id)\n    data = track\n  } else {\n    data = await getInfoBase<TrackInfo>(url, clientID, axiosInstance)\n  }\n\n  if (!data.media) throw new Error('The given URL does not link to a Soundcloud track')\n  return data\n}\n\n/** @internal */\nexport const getSetInfo = async (url: string, clientID: string, axiosInstance: AxiosInstance): Promise<SetInfo> => {\n  const data = await getSetInfoBase(url, clientID, axiosInstance)\n  if (!data.tracks) throw new Error('The given URL does not link to a Soundcloud set')\n  return data\n}\n\n/** @internal */\nexport const getTrackInfoByID = async (clientID: string, axiosInstance: AxiosInstance, ids: number[], playlistID?: number, playlistSecretToken?: string) => {\n  return await getTrackInfoBase(clientID, axiosInstance, ids, playlistID, playlistSecretToken)\n}\nexport default getInfo\n"],"mappings":"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"}
import{a as e,o as t,t as n}from"./info-Bcz2e-pp.js";import r from"m3u8stream";const i=async(t,n,r)=>{let i=await r.get(e(t,`client_id`,n),{headers:{"User-Agent":`Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.7339.52 Safari/537.36`,Accept:`*/*`,"Accept-Encoding":`gzip, deflate, br`},withCredentials:!0});if(!i.data.url)throw Error(`Invalid response from Soundcloud. Check if the URL provided is correct: ${t}`);return i.data.url},a=async(e,t)=>(await t.get(e,{withCredentials:!0,responseType:`stream`})).data,o=e=>r(e),s=async(e,n,r,i,a,o)=>{try{let t=await r(e,n,o);return e.includes(`/progressive`)?await i(t,o):a(t)}catch(e){throw t(e)}},c=async(e,t,n)=>await s(e,t,i,a,o,n),l=async(e,t,n,r,i,a,o)=>{if(!f(e))throw Error(`Invalid media object provided`);return await a(e.url,t,o)},u=async(e,t,n)=>await l(e,t,i,a,o,c,n),d=async(t,n,r)=>{let{data:{redirectUri:i}}=await r.get(e(`https://api-v2.soundcloud.com/tracks/${t}/download`,`client_id`,n)),{data:a}=await r.get(i,{responseType:`stream`});return a},f=e=>!(!e||!e.url||!e.format||!e.format.protocol||![`hls`,`progressive`].includes(e.format.protocol)),p=async(e,t,r,i=!0)=>{let a=await n(e,t,r);if(a.downloadable&&i)try{return await d(a.id,t,r)}catch{console.log(`Download link failed, trying transcoding...`)}let o=a.media.transcodings.filter(e=>f(e)&&e.url&&e.format&&(e.format.protocol===`hls`||e.format.protocol===`progressive`));if(o.length===0)throw Error(`No valid transcoding available for this track`);o.find(e=>e.format.protocol===`progressive`)||o[0];for(let e=0;e<o.length;e++){let n=o[e];try{return await u(n,t,r)}catch(t){if(console.log(`Transcoding failed: ${n.format.protocol}, trying next...`),e===o.length-1)throw t}}};export{p as download,d as fromDownloadLink,u as fromMediaObj,l as fromMediaObjBase,c as fromURL,s as fromURLBase,o as getHLSStream,i as getMediaURL,a as getProgressiveStream};
//# sourceMappingURL=download.js.map